<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eye Tracking App</title>
    <link rel="stylesheet" href="/static/css/style.css" />
</head>
<body>
    <h1 id="eyeTrackingData">Eye Tracking Data: </h1>
    
    <div class="main" id="main">
        <div class="flex-container" id="c1">
            <div class="oval" id="o1"></div>
            <div class="oval" id="o2"></div>
            <div class="oval" id="o3"></div>
    
    
        </div>
    
        <div class="flex-container" id="c2">
            
            <div class="oval" id="o4"></div>
            <!-- <h1 id="dz">dead zone</h1> -->
    
            <!-- <div class="oval" id="o5">
                <h1>Dead Zone</h1>
            </div> -->
            <div class="oval" id="o6"></div>
        </div>
    
        <div class="flex-container" id="c3">
            <div class="oval" id="o7"></div>
            <div class="oval" id="o8">
                <!-- <h1>Rear View</h1> -->
            </div>
            <div class="oval" id="o9"></div>
        </div>
    </div>  

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
    <script>
        console.log('test');
        var socket = io.connect('http://127.0.0.1:4999/');

        socket.on('connect', function() {
            console.log('Connected to server');
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from server');
        });
        
        socket.on('reconnect_attempt', function(attemptNumber) {
            console.log('Attempting to reconnect (attempt ' + attemptNumber + ')');
        });
        
        socket.on('reconnect_failed', function() {
            console.log('Reconnection attempts exhausted. Could not reconnect.');
        });

        // get updates from the server
        socket.on('update_eye_tracking_data', function(data) {
            console.log('got it');
            document.getElementById('eyeTrackingData').innerText = 'Eye Tracking Data: ' + data.data;
            var objectId = data.data; // objectId is the return from the gaze_id function
            console.log(objectId);
            update(objectId);
        });

        // request updates from the server
        setInterval(function() {
            console.log('emit get eye tracking');
            socket.emit('get_eye_tracking_data');
            console.log('emitted yayy')
        }, 1000);

        function update(objectId) { // gets objectId from gaze_id() in utils.py
            resetBackgroundColor();
            updateBackgroundColorById(objectId, 'green');
        }

        function updateBackgroundColorById(objectId, newColor) {
            // Get the element with the specified ID
            var element = document.getElementById(objectId);
            // console.log(element);

            // Check if the element exists
            if (element) {
                // Update the background color
                element.style.backgroundColor = newColor;
            } else {
                console.error("Element with ID '" + objectId + "' not found.");
            }
        }


        function resetBackgroundColor() {
            var elements = document.getElementsByClassName("oval");
            for (var i = 0; i < elements.length; i++) {
                elements[i].style.backgroundColor = "red";
            }
        }


    </script>

</body>
</html>
